# 加速度センサーによる音楽再生システム
## 使用方法ガイド

### 1. システム概要
このアプリケーションは、加速度センサー（M5Stack）の動きに応じて音楽と画像を切り替えるシステムです。
センサーの動きの強さによって、異なる音楽が再生されます。

### 2. 必要な機器・環境
- M5Stack（加速度センサー搭載）
- Node.js（バージョン16以上）
- Webブラウザ（Google Chrome推奨）
- ネットワーク環境

### 3. セットアップ方法

#### 3.1 サーバーの準備
1. サーバーフォルダに移動
```bash
cd server
```

2. 必要なパッケージのインストール
```bash
npm install
```

3. サーバーの起動
```bash
npm start
```

#### 3.2 クライアントの準備
1. 新しいターミナルでクライアントフォルダに移動
```bash
cd client
```

2. 必要なパッケージのインストール
```bash
npm install
```

3. クライアントの起動
```bash
npm start
```

### 4. 動作確認

1. ブラウザで以下のURLにアクセス
```
http://localhost:3000
```

2. 画面に「信号による画像とBGMの切り替え」というタイトルが表示されることを確認

### 5. 音楽再生の仕組み

#### 5.1 動作の閾値
- 20以下：音楽0（くるみ）
- 20超30以下：音楽1（アリア）
- 30超：音楽2（gline）

#### 5.2 再生の特徴
- 各音楽は最後まで再生すると自動的に最初から再生されます
- 音楽が切り替わっても、同じ音楽に戻ると前回の再生位置から再開します
- すべての音楽は一定の音量で再生されます

### 6. データの記録

#### 6.1 記録されるデータ
- 加速度データ（csv_data/[日付]/Device_[ID]/に保存）
  - 時刻
  - M5Stackの時間
  - 加速度ノルム
  - X軸加速度
  - Y軸加速度
  - Z軸加速度

- 再生データ（csv_data/[日付]/playback_data/に保存）
  - タイムスタンプ
  - 音楽ID
  - 平均値

#### 6.2 ファイル命名規則
- 加速度データ：`[日付]_[デバイスID]_[タイムスタンプ].csv`
- 再生データ：`[日付]_playback_[起動時刻].csv`

### 7. トラブルシューティング

#### 7.1 音楽が再生されない場合
1. ブラウザの音量設定を確認
2. 「再生」ボタンをクリック
3. ページのリロードを試す

#### 7.2 センサーが認識されない場合
1. M5Stackの電源を確認
2. ネットワーク接続を確認
3. サーバーを再起動

#### 7.3 データが記録されない場合
1. csv_dataフォルダの書き込み権限を確認
2. サーバーのエラーログを確認
3. ディスクの空き容量を確認

### 8. 注意事項
- サーバーを再起動すると、新しいCSVファイルが作成されます
- 長時間の使用ではデータファイルが大きくなる可能性があります
- センサーの動きが激しすぎると、正確な計測ができない場合があります

### 9. 連絡先・サポート
問題が発生した場合は、以下の情報と共に報告してください：
- 発生時刻
- エラーメッセージ（もしあれば）
- 実行していた操作
- ログファイルの内容 
